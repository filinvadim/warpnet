"use strict";(self["webpackChunkwarpnet_frontend"]=self["webpackChunkwarpnet_frontend"]||[]).push([[871],{1311:function(e,s,t){t.r(s),t.d(s,{default:function(){return _}});var a=t(641),l=t(33),r=t(3751);const o={class:"flex container h-full w-full"},i={class:"flex-1 flex flex-col h-full"},d={class:"px-4 py-3 border-b border-lighter flex items-center"},n={key:0,class:"flex items-center"},c=["src"],h={class:"font-bold"},u={class:"text-sm text-dark"},g={class:"flex-1 overflow-y-auto p-4",ref:"messageContainer"},f={key:0,class:"flex justify-center"},w={class:"text-xs mt-1 text-gray-500"},m={class:"border-t border-lighter px-4 py-3"};function p(e,s,t,p,x,v){const k=(0,a.g2)("SideNav"),b=(0,a.g2)("router-link"),_=(0,a.g2)("Loader"),y=(0,a.gN)("linkify");return(0,a.uX)(),(0,a.CE)("div",o,[(0,a.bF)(k),(0,a.Lk)("div",i,[(0,a.Lk)("div",d,[(0,a.bF)(b,{to:{name:"Chats"},class:"mr-4"},{default:(0,a.k6)((()=>s[2]||(s[2]=[(0,a.Lk)("i",{class:"fas fa-arrow-left text-xl text-blue"},null,-1)]))),_:1}),x.chat?((0,a.uX)(),(0,a.CE)("div",n,[(0,a.Lk)("img",{src:x.otherUser.avatar||"default_profile.png",class:"w-10 h-10 rounded-full mr-3"},null,8,c),(0,a.Lk)("div",null,[(0,a.Lk)("p",h,(0,l.v_)(x.otherUser.username),1),(0,a.Lk)("p",u,"@"+(0,l.v_)(x.chat.other_user_id),1)])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",g,[x.loading?((0,a.uX)(),(0,a.CE)("div",f,[(0,a.bF)(_,{loading:x.loading},null,8,["loading"])])):((0,a.uX)(!0),(0,a.CE)(a.FK,{key:1},(0,a.pI)(x.messages,(s=>((0,a.uX)(),(0,a.CE)("div",{key:s.id,class:(0,l.C4)(["mb-4 flex",{"justify-end":s.sender_id===x.currentUserId}])},[(0,a.Lk)("div",{class:(0,l.C4)(["max-w-3/4 rounded-lg px-4 py-2",s.sender_id===x.currentUserId?"bg-blue text-white":"bg-lighter"])},[(0,a.bo)(((0,a.uX)(),(0,a.CE)("p",null,[(0,a.eW)((0,l.v_)(s.text),1)])),[[y]]),(0,a.Lk)("p",w,(0,l.v_)(e.$filters.timeago(s.created_at)),1)],2)],2)))),128))],512),(0,a.Lk)("div",m,[(0,a.Lk)("form",{onSubmit:s[1]||(s[1]=(0,r.D$)(((...e)=>v.sendMessage&&v.sendMessage(...e)),["prevent"])),class:"flex"},[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>x.newMessage=e),type:"text",placeholder:"Type a message...",class:"flex-1 rounded-full border border-lighter px-4 py-2 mr-2"},null,512),[[r.Jo,x.newMessage]]),s[3]||(s[3]=(0,a.Lk)("button",{type:"submit",class:"bg-blue text-white rounded-full px-6 py-2"}," Send ",-1))],32)])])])}t(4114);var x=t(1787),v={name:"Chat",components:{SideNav:(0,a.$V)((()=>t.e(214).then(t.bind(t,3214)))),Loader:(0,a.$V)((()=>t.e(394).then(t.bind(t,5394))))},data(){return{loading:!0,chat:null,messages:[],newMessage:"",chatId:void 0,currentUserId:void 0,otherUser:void 0}},methods:{async loadChat(){try{this.chat=await x.n.getChat({chatId:this.chatId})}catch(e){console.error("Error loading chat:",e)}},async loadMessages(){try{const e=await x.n.getDirectMessages({chatId:this.chatId,cursorReset:!0});this.messages=[...e,...this.messages]}catch(e){console.error("Error loading messages:",e)}},async sendMessage(){if(this.newMessage.trim())try{const e=await x.n.sendDirectMessage({chatId:this.chatId,receiverId:this.otherUser.id,text:this.newMessage});this.messages.push(e),this.newMessage="",this.scrollToBottom()}catch(e){console.error("Error sending message:",e)}},scrollToBottom(){this.$nextTick((()=>{const e=this.$refs.messageContainer;e.scrollTop=e.scrollHeight}))}},async created(){console.log("loading component:",this.$options.name),this.currentUserId=this.$route.params.id,this.chatId=this.$route.params.chatId,await Promise.all([this.loadChat(),this.loadMessages()]),this.chat.owner_id!==this.currentUserId?this.otherUser=await x.n.getProfile(this.chat.owner_id):this.otherUser=await x.n.getProfile(this.chat.other_user_id),this.otherUser.avatar=await x.n.getImage({userId:this.otherUser.id,key:this.otherUser.avatar_key}),this.loading=!1,this.scrollToBottom()}},k=t(6262);const b=(0,k.A)(v,[["render",p]]);var _=b},2286:function(e,s,t){t.r(s),t.d(s,{default:function(){return U}});var a=t(641),l=t(33);const r={id:"app",class:"flex container h-full w-full"},o={class:"flex container h-full w-full"},i={class:"w-full sm:w-1/3 md:w-1/2 lg:w-1/2 h-full overflow-y-scroll no-scrollbar hidden md:block"},d={class:"px-5 py-3 border-b border-lighter flex"},n={key:0},c={key:0,class:"flex flex-col items-center justify-center w-full pt-10"},h={key:0},u={class:"cursor-pointer"},g=["onClick"],f={class:"flex-none mr-2 md:mr-4 pt-1"},w=["href"],m=["src"],p={class:"w-full truncate"},x={class:"flex items-center w-full"},v={class:"font-semibold"},k={class:"hidden md:block text-sm text-dark ml-2 truncate"},b={class:"text-sm text-dark ml-auto"},_={class:"pb-2 truncate"};function y(e,s,t,y,M,L){const C=(0,a.g2)("SideNav"),I=(0,a.g2)("Loader"),U=(0,a.g2)("NewMessageOverlay"),N=(0,a.gN)("linkify"),E=(0,a.gN)("scroll");return(0,a.bo)(((0,a.uX)(),(0,a.CE)("div",r,[(0,a.Lk)("div",o,[(0,a.bF)(C),(0,a.Lk)("div",i,[(0,a.Lk)("div",d,[s[2]||(s[2]=(0,a.Lk)("h1",{class:"text-xl font-bold flex-1"},"Chats",-1)),s[3]||(s[3]=(0,a.Lk)("i",{class:"fas fa-cog text-xl text-blue cursor-pointer"},null,-1)),(0,a.Lk)("i",{onClick:s[0]||(s[0]=e=>L.newMessage()),class:"fas fa-plus-circle ml-3 text-xl text-blue cursor-pointer"})]),(0,a.bF)(I,{loading:M.loading},null,8,["loading"]),M.loading?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",n,[0===M.chats.length?((0,a.uX)(),(0,a.CE)("div",c,s[4]||(s[4]=[(0,a.Lk)("div",{class:"w-1/2 flex flex-col items-center justify-center"},[(0,a.Lk)("p",{class:"font-bold text-lg"},"No chats yet"),(0,a.Lk)("p",{class:"text-sm text-dark"}," Wait until someone starts a chat here. ")],-1)]))):(0,a.Q3)("",!0),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(M.chats,(s=>((0,a.uX)(),(0,a.CE)("div",{key:s.id},[L.getUser(s.other_user_id)?((0,a.uX)(),(0,a.CE)("div",h,[(0,a.Lk)("div",u,[(0,a.Lk)("div",{class:"w-full p-2 pt-1 pb-1 md:p-4 md:pt-2 md:pb-2 border-b hover:bg-lightest flex",onClick:e=>L.selectChat(s)},[(0,a.Lk)("div",f,[(0,a.Lk)("a",{href:`#/${s.other_user_id}`},[(0,a.Lk)("img",{src:L.getUser(s.other_user_id).avatar||"default_profile.png",class:"flex-none w-12 h-12 rounded-full"},null,8,m)],8,w)]),(0,a.Lk)("div",p,[(0,a.Lk)("div",x,[(0,a.Lk)("p",v,(0,l.v_)(L.getUser(s.other_user_id).username||"Anonymous"),1),(0,a.Lk)("p",k," @"+(0,l.v_)(s.other_user_id),1),(0,a.Lk)("p",b,(0,l.v_)(e.$filters.timeago(s.lastModified)),1)]),(0,a.bo)(((0,a.uX)(),(0,a.CE)("p",_,[(0,a.eW)((0,l.v_)(s.last_message||""),1)])),[[N]])])],8,g)])])):(0,a.Q3)("",!0)])))),128))]))]),s[5]||(s[5]=(0,a.Lk)("div",{class:"w-full border-l border-r border-lighter h-screen flex items-center justify-center"},[(0,a.Lk)("div",{class:"text-center"},[(0,a.Lk)("h2",{class:"text-2xl font-bold mb-4"},"Select a chat"),(0,a.Lk)("p",{class:"text-gray-600"},"Choose a chat from the list to start chatting")])],-1)),M.showNewMessageModal?((0,a.uX)(),(0,a.Wv)(U,{key:0,showNewMessageModal:M.showNewMessageModal,"onUpdate:showNewMessageModal":s[1]||(s[1]=e=>M.showNewMessageModal=e),profileId:M.profileId,onSelected:L.selected},null,8,["showNewMessageModal","profileId","onSelected"])):(0,a.Q3)("",!0)])])),[[E,L.loadMore,"bottom"]])}t(4114),t(8111),t(116);var M=t(1787),L={name:"Chats",components:{NewMessageOverlay:(0,a.$V)((()=>t.e(3).then(t.bind(t,8003)))),Loader:(0,a.$V)((()=>t.e(394).then(t.bind(t,5394)))),SideNav:(0,a.$V)((()=>t.e(214).then(t.bind(t,3214))))},data(){return{loading:!0,showNewMessageModal:!1,chats:[],profileId:"",usersMap:new Map,otherUser:void 0}},methods:{newMessage(){this.showNewMessageModal=!0},async selectChat(e){e&&0!==e.id.length&&(console.log("selectChat()"),this.$router.push({name:"Messages",params:{id:this.$route.params.id,chatId:e.id}}))},async selected(e){if(console.log("selected()"),!e||0===e.id.length)return;this.showNewMessageModal=!1;const s=this.chats.find((s=>s.other_user_id===e.id));if(s)return void await this.selectChat(s);const t=await M.n.createChat(e.id);await this.selectChat(t)},getUser(e){return this.usersMap.get(e)},async loadChatUser(e){if(!e||0===e.length)return;const s=await M.n.getProfile(e);s.avatar=await M.n.getImage({userId:s.id,key:s.avatar_key}),this.usersMap.set(s.id,s),console.log("usersMap",this.usersMap)},async loadMore(){const e=await M.n.getChats(!1);for(const s of e)await this.loadChatUser(s.other_user_id),await this.loadChatUser(s.owner_id);this.chats=[...this.chats,...e]}},async created(){console.log("loading component:",this.$options.name),this.profileId=this.$route.params.id,await this.loadChatUser(this.profileId);const e=await M.n.getChats(!0);for(const s of e)await this.loadChatUser(s.owner_id),await this.loadChatUser(s.other_user_id),s.owner_id!==this.profileId&&([s.owner_id,s.other_user_id]=[s.other_user_id,s.owner_id]);this.chats=e,this.loading=!1}},C=t(6262);const I=(0,C.A)(L,[["render",y]]);var U=I},5939:function(e,s,t){t.r(s),t.d(s,{default:function(){return B}});var a=t(641),l=t(33),r=t(3751);const o={id:"app",class:"flex h-full w-full"},i={class:"hidden md:flex flex-col w-1/3 h-full overflow-y-scroll border-r border-lighter"},d={class:"px-5 py-3 border-b border-lighter flex items-center"},n={key:0,class:"flex flex-col items-center justify-center pt-10"},c=["onClick"],h={class:"flex items-start px-4 py-2 hover:bg-lightest border-b"},u={class:"mr-4"},g=["src"],f={class:"w-full truncate"},w={class:"flex items-center"},m={class:"font-semibold truncate"},p={class:"text-sm text-dark ml-2 truncate hidden md:block"},x={class:"text-sm text-dark ml-auto"},v={class:"text-sm truncate"},k={key:0,class:"flex flex-col w-full md:w-2/3 h-full items-center justify-center"},b={class:"w-3/5 text-center"},_={key:1,class:"flex flex-col w-full md:w-2/3 h-full"},y={class:"flex items-center px-5 py-2 border-b border-lighter bg-white sticky top-0"},M={class:"mr-4"},L=["src"],C={class:"flex flex-col"},I={class:"font-bold"},U={class:"text-xs text-dark"},N={class:"flex-1 overflow-y-scroll px-5 pt-5 no-scrollbar"},E={class:"flex flex-col-reverse"},$={ref:"scrollToMe"},X={key:0,class:"flex justify-end mb-4"},T={class:"bg-blue text-white py-2 px-4 rounded-tl-3xl rounded-bl-3xl rounded-tr-xl"},P={class:"text-xs text-dark ml-2"},S={key:1,class:"flex items-start mb-4"},V=["src"],F={class:"bg-lighter text-black py-2 px-4 rounded-tr-3xl rounded-tl-xl rounded-br-3xl"},A={class:"text-xs text-dark ml-2"},Q={class:"px-5 py-3 border-t border-lighter flex items-center bg-white"},j=["disabled"],D=["disabled"];function R(e,s,t,R,O,W){const H=(0,a.g2)("SideNav"),K=(0,a.g2)("Loader"),B=(0,a.g2)("NewMessageOverlay"),J=(0,a.gN)("linkify"),Y=(0,a.gN)("scroll");return(0,a.uX)(),(0,a.CE)("div",o,[(0,a.bF)(H),(0,a.Lk)("div",i,[(0,a.Lk)("div",d,[s[7]||(s[7]=(0,a.Lk)("h1",{class:"text-xl font-bold flex-1"},"Chats",-1)),s[8]||(s[8]=(0,a.Lk)("i",{class:"fas fa-cog text-xl text-blue cursor-pointer"},null,-1)),(0,a.Lk)("i",{onClick:s[0]||(s[0]=e=>W.newMessage()),class:"fas fa-plus-circle ml-3 text-xl text-blue cursor-pointer"})]),(0,a.bF)(K,{loading:O.loading},null,8,["loading"]),O.loading?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[0===O.chats.length?((0,a.uX)(),(0,a.CE)("div",n,s[9]||(s[9]=[(0,a.Lk)("p",{class:"font-bold text-lg"},"No chats yet",-1),(0,a.Lk)("p",{class:"text-sm text-dark"},"Wait until someone starts a chat here.",-1)]))):(0,a.Q3)("",!0),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(O.chats,(s=>((0,a.uX)(),(0,a.CE)("div",{key:s.id,class:(0,l.C4)(["cursor-pointer",s.id===O.active?.id?"border-r-2 border-blue":""]),onClick:e=>W.selectChat(s)},[(0,a.Lk)("div",h,[(0,a.Lk)("div",u,[(0,a.Lk)("img",{src:W.getUser(s.other_user_id)?.avatar||"default_profile.png",class:"h-12 w-12 rounded-full"},null,8,g)]),(0,a.Lk)("div",f,[(0,a.Lk)("div",w,[(0,a.Lk)("p",m,(0,l.v_)(W.getUser(s.other_user_id)?.username||"Anonymous"),1),(0,a.Lk)("p",p," @"+(0,l.v_)(s.other_user_id),1),(0,a.Lk)("p",x,(0,l.v_)(e.$filters.timeago(s.updated_at)),1)]),(0,a.bo)(((0,a.uX)(),(0,a.CE)("p",v,[(0,a.eW)((0,l.v_)(s.last_message||""),1)])),[[J]])])])],10,c)))),128))],64))]),O.loading||!O.active?((0,a.uX)(),(0,a.CE)("div",k,[(0,a.Lk)("div",b,[s[10]||(s[10]=(0,a.Lk)("p",{class:"font-bold text-lg"},"You don’t have a message selected",-1)),s[11]||(s[11]=(0,a.Lk)("p",{class:"text-sm text-dark mt-2"}," This is where you’ll see messages from people you don’t follow. ",-1)),(0,a.Lk)("button",{onClick:s[1]||(s[1]=e=>W.newMessage()),class:"mt-5 h-10 px-4 text-white font-semibold bg-blue hover:bg-darkblue rounded-full"}," New Message ")])])):(0,a.Q3)("",!0),!O.loading&&O.active?((0,a.uX)(),(0,a.CE)("div",_,[(0,a.Lk)("div",y,[(0,a.Lk)("button",{onClick:s[2]||(s[2]=e=>W.gotoHome()),class:"block md:hidden mr-2 focus:outline-none"},s[12]||(s[12]=[(0,a.Lk)("i",{class:"fas fa-arrow-left text-blue"},null,-1)])),(0,a.Lk)("div",M,[(0,a.Lk)("img",{src:W.getUser(O.active.other_user_id)?.avatar||"default_profile.png",class:"w-6 h-6 rounded-full"},null,8,L)]),(0,a.Lk)("div",C,[(0,a.Lk)("h1",I,(0,l.v_)(W.getUser(O.active.other_user_id)?.username),1),(0,a.Lk)("p",U,"@"+(0,l.v_)(O.active.other_user_id),1)]),s[13]||(s[13]=(0,a.Lk)("i",{class:"fas fa-info-circle ml-auto text-xl text-blue cursor-pointer"},null,-1))]),(0,a.bo)(((0,a.uX)(),(0,a.CE)("div",N,[(0,a.Lk)("div",E,[(0,a.Lk)("div",$,null,512),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(O.messages,(s=>((0,a.uX)(),(0,a.CE)("div",{key:s.id},[s.sender_id===O.ownerProfile.id?((0,a.uX)(),(0,a.CE)("div",X,[(0,a.Lk)("div",T,(0,l.v_)(s.text),1),(0,a.Lk)("p",P,(0,l.v_)(e.$filters.time(s.created_at)),1)])):((0,a.uX)(),(0,a.CE)("div",S,[(0,a.Lk)("img",{src:W.getUser(O.active.other_user_id)?.avatar||"default_profile.png",class:"h-8 w-8 rounded-full mr-2"},null,8,V),(0,a.Lk)("div",F,(0,l.v_)(s.text),1),(0,a.Lk)("p",A,(0,l.v_)(e.$filters.time(s.created_at)),1)]))])))),128))])])),[[Y,W.loadMore,"top"]]),(0,a.Lk)("div",Q,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":s[3]||(s[3]=e=>O.text=e),type:"search",class:"flex-1 px-4 py-2 rounded-full bg-lighter focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue text-sm",placeholder:"Start a new message",onKeyup:s[4]||(s[4]=(0,r.jR)(((...e)=>W.sendMessage&&W.sendMessage(...e)),["enter"])),disabled:O.disabled},null,40,j),[[r.Jo,O.text]]),(0,a.Lk)("button",{onClick:s[5]||(s[5]=(...e)=>W.sendMessage&&W.sendMessage(...e)),disabled:O.disabled||!O.text.length,class:(0,l.C4)(["ml-4 w-8 h-8 rounded-full focus:outline-none",0===O.text.length?"opacity-50 cursor-default":"hover:bg-lightblue"])},s[14]||(s[14]=[(0,a.Lk)("i",{class:"fas fa-arrow-right text-blue text-xl"},null,-1)]),10,D)])])):(0,a.Q3)("",!0),O.showNewMessageModal?((0,a.uX)(),(0,a.Wv)(B,{key:2,profileId:O.active?.other_user_id,showNewMessageModal:O.showNewMessageModal,"onUpdate:showNewMessageModal":s[6]||(s[6]=e=>O.showNewMessageModal=e),onSelected:W.selected},null,8,["profileId","showNewMessageModal","onSelected"])):(0,a.Q3)("",!0)])}t(4114);var O=t(1787),W={name:"Messages",components:{SideNav:(0,a.$V)((()=>t.e(214).then(t.bind(t,3214)))),Loader:(0,a.$V)((()=>t.e(394).then(t.bind(t,5394)))),NewMessageOverlay:(0,a.$V)((()=>t.e(3).then(t.bind(t,8003))))},data(){return{loading:!0,disabled:!1,showNewMessageModal:!1,chats:[],messages:[],ownerProfile:void 0,active:void 0,text:"",usersMap:new Map,otherUser:void 0}},methods:{newMessage(){this.showNewMessageModal=!0},gotoHome(){this.$router.push({name:"Home"})},async sendMessage(){if(!this.active.other_user_id||0===this.text.length)return;this.disabled=!0;const e=await O.n.sendDirectMessage({chatId:this.active.id,receiverId:this.active.other_user_id,text:this.text});this.messages=[e,...this.messages],this.text="",this.disabled=!1,await this.$nextTick((()=>{this.scrollToEnd()}))},scrollToEnd(){this.$nextTick((()=>{const e=this.$refs.scrollToMe;e&&e.scrollIntoView({behavior:"smooth"}),this.$refs.input&&setTimeout((()=>this.$refs.input.focus()),500)}))},async selected(e){if(!this.ownerProfile.id||!e.id)return void console.log("messages: no selected(user)",this.ownerProfile,e);this.showNewMessageModal=!1;let s=null;for(const t of this.chats){const a=[t.owner_id,t.other_user_id];if(a.includes(this.ownerProfile.id)&&a.includes(e.id)){s=t;break}}s||(s={id:"",other_user_id:e.id,owner_id:this.ownerProfile.id}),await this.selectChat(s)},async selectChat(e){e?(this.messages=[],this.active=e,this.messages=await O.n.getDirectMessages({chatId:e.id,cursorReset:!0}),this.scrollToEnd()):console.warn("no active chat selected")},deselectAll(){this.active=void 0},getUser(e){return this.usersMap.get(e)},async loadChatUser(e){const s=await O.n.getProfile(e);s.avatar=await O.n.getImage({userId:s.id,key:s.avatar_key}),this.usersMap.set(s.id,s)},async loadMore(){if(!this.active)return;const e=await O.n.getDirectMessages({chatId:this.active.chat.id,cursorReset:!1});this.messages=[...this.messages,...e.messages]}},async created(){console.log("loading component:",this.$options.name),console.log("messages: route chat id:",this.$route.params.chatId),this.ownerProfile=O.n.getOwnerProfile(),await this.loadChatUser(this.ownerProfile.id);const e=await O.n.getChats(!0);if(0===e.length)return console.warn("messages: chats not found"),void(this.loading=!1);let s=null;for(const t of e)await this.loadChatUser(t.owner_id),await this.loadChatUser(t.other_user_id),t.id===this.$route.params.chatId&&(console.log("ACTIVE CHAT",JSON.stringify(t)),console.log("ACTIVE CHAT owner",t.owner_id,"other",t.other_user_id),s=t),t.owner_id!==this.ownerProfile.id&&([t.owner_id,t.other_user_id]=[t.other_user_id,t.owner_id]);this.chats=e,await this.selectChat(s),this.loading=!1}},H=t(6262);const K=(0,H.A)(W,[["render",R]]);var B=K},116:function(e,s,t){var a=t(6518),l=t(2652),r=t(9306),o=t(8551),i=t(1767);a({target:"Iterator",proto:!0,real:!0},{find:function(e){o(this),r(e);var s=i(this),t=0;return l(s,(function(s,a){if(e(s,t++))return a(s)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})}}]);
//# sourceMappingURL=messages.bdd92480.js.map