"use strict";(self["webpackChunkwarpnet_frontend"]=self["webpackChunkwarpnet_frontend"]||[]).push([[871],{9620:function(e,s,t){t.r(s),t.d(s,{default:function(){return y}});var l=t(641),a=t(33),o=t(3751);const r={class:"flex container h-full w-full"},i={class:"flex-1 flex flex-col h-full"},n={class:"px-4 py-3 border-b border-lighter flex items-center"},d={key:0,class:"flex items-center"},c=["src"],h={class:"font-bold"},u={class:"text-sm text-dark"},f={class:"flex-1 overflow-y-auto p-4",ref:"messageContainer"},g={key:0,class:"flex justify-center"},p={class:"text-xs mt-1 text-gray-500"},m={class:"border-t border-lighter px-4 py-3"};function v(e,s,t,v,w,x){const k=(0,l.g2)("SideNav"),b=(0,l.g2)("router-link"),y=(0,l.g2)("Loader"),L=(0,l.gN)("linkify");return(0,l.uX)(),(0,l.CE)("div",r,[(0,l.bF)(k),(0,l.Lk)("div",i,[(0,l.Lk)("div",n,[(0,l.bF)(b,{to:{name:"Chats"},class:"mr-4"},{default:(0,l.k6)((()=>s[2]||(s[2]=[(0,l.Lk)("i",{class:"fas fa-arrow-left text-xl text-blue"},null,-1)]))),_:1}),w.chat?((0,l.uX)(),(0,l.CE)("div",d,[(0,l.Lk)("img",{src:this.otherUser.avatar||"default_profile.png",class:"w-10 h-10 rounded-full mr-3"},null,8,c),(0,l.Lk)("div",null,[(0,l.Lk)("p",h,(0,a.v_)(this.otherUser.username),1),(0,l.Lk)("p",u,"@"+(0,a.v_)(w.chat.other_user_id),1)])])):(0,l.Q3)("",!0)]),(0,l.Lk)("div",f,[w.loading?((0,l.uX)(),(0,l.CE)("div",g,[(0,l.bF)(y,{loading:w.loading},null,8,["loading"])])):((0,l.uX)(!0),(0,l.CE)(l.FK,{key:1},(0,l.pI)(w.messages,(s=>((0,l.uX)(),(0,l.CE)("div",{key:s.id,class:(0,a.C4)(["mb-4 flex",{"justify-end":s.owner_id===w.currentUserId}])},[(0,l.Lk)("div",{class:(0,a.C4)(["max-w-3/4 rounded-lg px-4 py-2",s.owner_id===w.currentUserId?"bg-blue text-white":"bg-lighter"])},[(0,l.bo)(((0,l.uX)(),(0,l.CE)("p",null,[(0,l.eW)((0,a.v_)(s.content),1)])),[[L]]),(0,l.Lk)("p",p,(0,a.v_)(e.$filters.timeago(s.created_at)),1)],2)],2)))),128))],512),(0,l.Lk)("div",m,[(0,l.Lk)("form",{onSubmit:s[1]||(s[1]=(0,o.D$)(((...e)=>x.sendMessage&&x.sendMessage(...e)),["prevent"])),class:"flex"},[(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>w.newMessage=e),type:"text",placeholder:"Type a message...",class:"flex-1 rounded-full border border-lighter px-4 py-2 mr-2"},null,512),[[o.Jo,w.newMessage]]),s[3]||(s[3]=(0,l.Lk)("button",{type:"submit",class:"bg-blue text-white rounded-full px-6 py-2"}," Send ",-1))],32)])])])}t(4114);var w=t(1787),x={name:"Chat",components:{SideNav:(0,l.$V)((()=>t.e(529).then(t.bind(t,8529)))),Loader:(0,l.$V)((()=>t.e(945).then(t.bind(t,4945))))},data(){return{loading:!0,chat:null,messages:[],newMessage:"",chatId:void 0,currentUserId:void 0,otherUser:void 0}},methods:{async loadChat(){try{this.chat=await w.n.getChat({chatId:this.chatId})}catch(e){console.error("Error loading chat:",e)}},async loadMessages(){try{const e=await w.n.getDirectMessages({chatId:this.chatId,cursorReset:!0});this.messages=[...e,...this.messages],this.loading=!1}catch(e){console.error("Error loading messages:",e),this.loading=!1}},async sendMessage(){if(this.newMessage.trim())try{const e=await w.n.sendDirectMessage({chatId:this.chatId,text:this.newMessage});this.messages.push(e),this.newMessage="",this.scrollToBottom()}catch(e){console.error("Error sending message:",e)}},scrollToBottom(){this.$nextTick((()=>{const e=this.$refs.messageContainer;e.scrollTop=e.scrollHeight}))}},async created(){console.log("loading component:",this.$options.name),this.currentUserId=this.$route.params.id,this.chatId=this.$route.params.chatId;const e=this.chatId.split(":")[0];this.otherUser=await w.n.getProfile(e),await Promise.all([this.loadChat(),this.loadMessages()]),this.scrollToBottom()}},k=t(6262);const b=(0,k.A)(x,[["render",v]]);var y=b},1849:function(e,s,t){t.r(s),t.d(s,{default:function(){return E}});var l=t(641),a=t(33);const o={id:"app",class:"flex container h-full w-full"},r={class:"flex container h-full w-full"},i={class:"w-full sm:w-1/3 md:w-1/2 lg:w-1/2 h-full overflow-y-scroll no-scrollbar hidden md:block"},n={class:"px-5 py-3 border-b border-lighter flex"},d={key:0},c={key:0,class:"flex flex-col items-center justify-center w-full pt-10"},h={key:0},u={class:"cursor-pointer"},f=["onClick"],g={class:"flex-none mr-2 md:mr-4 pt-1"},p=["href"],m=["src"],v={class:"w-full truncate"},w={class:"flex items-center w-full"},x={class:"font-semibold"},k={class:"hidden md:block text-sm text-dark ml-2 truncate"},b={class:"text-sm text-dark ml-auto"},y={class:"pb-2 truncate"};function L(e,s,t,L,_,M){const C=(0,l.g2)("SideNav"),$=(0,l.g2)("Loader"),E=(0,l.g2)("NewMessageOverlay"),I=(0,l.gN)("linkify"),N=(0,l.gN)("scroll");return(0,l.bo)(((0,l.uX)(),(0,l.CE)("div",o,[(0,l.Lk)("div",r,[(0,l.bF)(C),(0,l.Lk)("div",i,[(0,l.Lk)("div",n,[s[2]||(s[2]=(0,l.Lk)("h1",{class:"text-xl font-bold flex-1"},"Chats",-1)),s[3]||(s[3]=(0,l.Lk)("i",{class:"fas fa-cog text-xl text-blue cursor-pointer"},null,-1)),(0,l.Lk)("i",{onClick:s[0]||(s[0]=e=>M.newMessage()),class:"fas fa-plus-circle ml-3 text-xl text-blue cursor-pointer"})]),(0,l.bF)($,{loading:_.loading},null,8,["loading"]),_.loading?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",d,[0===_.chats.length?((0,l.uX)(),(0,l.CE)("div",c,s[4]||(s[4]=[(0,l.Lk)("div",{class:"w-1/2 flex flex-col items-center justify-center"},[(0,l.Lk)("p",{class:"font-bold text-lg"},"No chats yet"),(0,l.Lk)("p",{class:"text-sm text-dark"}," Wait until someone starts a chat here. ")],-1)]))):(0,l.Q3)("",!0),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(_.chats,(s=>((0,l.uX)(),(0,l.CE)("div",{key:s.id},[M.getUser(s.other_user_id)?((0,l.uX)(),(0,l.CE)("div",h,[(0,l.Lk)("div",u,[(0,l.Lk)("div",{class:"w-full p-2 pt-1 pb-1 md:p-4 md:pt-2 md:pb-2 border-b hover:bg-lightest flex",onClick:e=>M.selectChat(s)},[(0,l.Lk)("div",g,[(0,l.Lk)("a",{href:`#/${s.other_user_id}`},[(0,l.Lk)("img",{src:M.getUser(s.other_user_id).avatar||"default_profile.png",class:"flex-none w-12 h-12 rounded-full"},null,8,m)],8,p)]),(0,l.Lk)("div",v,[(0,l.Lk)("div",w,[(0,l.Lk)("p",x,(0,a.v_)(M.getUser(s.other_user_id).username||"Anonymous"),1),(0,l.Lk)("p",k," @"+(0,a.v_)(s.other_user_id),1),(0,l.Lk)("p",b,(0,a.v_)(e.$filters.timeago(s.lastModified)),1)]),(0,l.bo)(((0,l.uX)(),(0,l.CE)("p",y,[(0,l.eW)((0,a.v_)(s.last_message||""),1)])),[[I]])])],8,f)])])):(0,l.Q3)("",!0)])))),128))]))]),s[5]||(s[5]=(0,l.Lk)("div",{class:"w-full border-l border-r border-lighter h-screen flex items-center justify-center"},[(0,l.Lk)("div",{class:"text-center"},[(0,l.Lk)("h2",{class:"text-2xl font-bold mb-4"},"Select a chat"),(0,l.Lk)("p",{class:"text-gray-600"},"Choose a chat from the list to start chatting")])],-1)),_.showNewMessageModal?((0,l.uX)(),(0,l.Wv)(E,{key:0,showNewMessageModal:_.showNewMessageModal,"onUpdate:showNewMessageModal":s[1]||(s[1]=e=>_.showNewMessageModal=e),profileId:this.profileId,onSelected:M.selected},null,8,["showNewMessageModal","profileId","onSelected"])):(0,l.Q3)("",!0)])])),[[N,M.loadMore,"bottom"]])}t(4114),t(8111),t(116);var _=t(1787),M={name:"Chats",components:{NewMessageOverlay:(0,l.$V)((()=>t.e(166).then(t.bind(t,2166)))),Loader:(0,l.$V)((()=>t.e(945).then(t.bind(t,4945)))),SideNav:(0,l.$V)((()=>t.e(529).then(t.bind(t,8529))))},data(){return{loading:!0,showNewMessageModal:!1,chats:[],profileId:"",usersMap:new Map,otherUser:void 0}},methods:{newMessage(){this.showNewMessageModal=!0},async selectChat(e){e&&0!==e.id.length&&(console.log("selectChat()"),this.$router.push({name:"Messages",params:{id:this.$route.params.id,chatId:e.id}}))},async selected(e){if(console.log("selected()"),!e||0===e.id.length)return;this.showNewMessageModal=!1;const s=this.chats.find((s=>s.other_user_id===e.id));if(s)return void await this.selectChat(s);const t=await _.n.createChat(e.id);await this.selectChat(t)},getUser(e){return console.log("getUser()"),console.log("chats.length",this.chats.length),this.usersMap.get(e)},async loadChatOtherUser(e){if(console.log("loadChatOtherUser()"),!e||0===e.length)return;const s=await _.n.getProfile(e);s.avatar=await _.n.getImage({userId:s.id,key:s.avatar_key}),this.usersMap.set(s.id,s),console.log("usersMap",this.usersMap)},async loadMore(){console.log("loadMore()");const e=await _.n.getChats(!1);for(const s of e)await this.loadChatOtherUser(s.other_user_id);this.chats=[...this.chats,...e]}},async created(){console.log("created()"),console.log("loading component:",this.$options.name),this.profileId=this.$route.params.id;const e=await _.n.getChats(!0);console.log("chats",e);for(const s of e)console.log("chat cycle",s),await this.loadChatOtherUser(s.other_user_id);console.log("usersMap",this.usersMap),console.log("end cycle"),this.chats=e,console.log("chats length",this.chats.length),this.loading=!1}},C=t(6262);const $=(0,C.A)(M,[["render",L]]);var E=$},4085:function(e,s,t){t.r(s),t.d(s,{default:function(){return ie}});var l=t(641),a=t(33),o=t(3751);const r={id:"app",class:"flex container h-full w-full"},i={class:"flex container h-full w-full"},n={class:"w-full sm:w-1/3 md:w-1/2 lg:w-1/2 h-full overflow-y-scroll no-scrollbar hidden md:block"},d={class:"px-5 py-3 border-b border-lighter flex"},c={key:0},h={key:0,class:"flex flex-col items-center justify-center w-full pt-10"},u=["onClick"],f={key:0},g={key:0},p={class:"flex-none mr-2 md:mr-4 pt-1"},m=["href"],v=["src"],w={class:"w-full truncate"},x={class:"flex items-center w-full"},k={class:"font-semibold"},b={key:0,class:"hidden md:block text-sm text-dark ml-2 truncate"},y={class:"text-sm text-dark ml-auto"},L={class:"pb-2 truncate"},_={key:0,class:"w-full z-0 h-screen border-l border-r border-lighter overflow-y-scroll no-scrollbar relative flex flex-col items-center justify-center",style:{display:"grid","grid-template-rows":"53px auto"}},M={class:"flex flex-col items-center justify-center w-full"},C={class:"w-3/5"},$={class:"flex justify-start mt-5"},E={key:1,class:"w-full border-l border-r border-lighter h-screen flex justify-center"},I={key:0},N={class:"flex-none mr-4"},U=["href"],X=["src"],T={class:"w-full flex flex-col"},j={class:"text-m font-bold flex-1"},Q={class:"text-dark text-xs"},S={class:"w-full pt-5 overflow-y-scroll no-scrollbar",style:{display:"grid","grid-template-rows":"auto"}},O={class:"w-full px-5 flex flex-col justify-between"},P={class:"flex flex-col-reverse mt-1 h-full",style:{"min-height":"100%"}},V={ref:"scrollToMe"},F={key:0},A={class:"flex justify-end"},D={class:"mr-2 py-3 px-4 bg-blue rounded-bl-3xl rounded-tl-3xl rounded-tr-xl text-white"},R={class:"flex justify-end w-full mb-4"},W={class:"text-xs text-dark mr-2"},H={key:1},K={class:"flex justify-start"},B={class:"flex-none mr-4"},J=["href"],q=["src"],z={class:"ml-2 py-3 px-4 bg-lighter rounded-br-3xl rounded-tr-3xl rounded-tl-xl text-black"},Y={class:"flex items-center w-full mb-4"},G={class:"text-xs text-dark ml-14"},Z={class:"bg-white px-5 p-3 border-t border-lighter flex w-full"},ee=["disabled"],se=["disabled"];function te(e,s,t,te,le,ae){const oe=(0,l.g2)("SideNav"),re=(0,l.g2)("Loader"),ie=(0,l.g2)("NewMessageOverlay"),ne=(0,l.gN)("linkify"),de=(0,l.gN)("scroll");return(0,l.uX)(),(0,l.CE)("div",r,[(0,l.Lk)("div",i,[(0,l.bF)(oe),(0,l.Lk)("div",n,[(0,l.Lk)("div",d,[s[9]||(s[9]=(0,l.Lk)("h1",{class:"text-xl font-bold flex-1"},"Chats",-1)),s[10]||(s[10]=(0,l.Lk)("i",{class:"fas fa-cog text-xl text-blue cursor-pointer"},null,-1)),(0,l.Lk)("i",{onClick:s[0]||(s[0]=e=>ae.newMessage()),class:"fas fa-plus-circle ml-3 text-xl text-blue cursor-pointer"})]),(0,l.bF)(re,{loading:le.loading},null,8,["loading"]),le.loading?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",c,[0===le.chats.length?((0,l.uX)(),(0,l.CE)("div",h,s[11]||(s[11]=[(0,l.Lk)("div",{class:"w-1/2 flex flex-col items-center justify-center"},[(0,l.Lk)("p",{class:"font-bold text-lg"},"No chats yet"),(0,l.Lk)("p",{class:"text-sm text-dark"}," Wait until someone starts a chat here. ")],-1)]))):(0,l.Q3)("",!0),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(le.chats,(s=>((0,l.uX)(),(0,l.CE)("div",{key:s.id},[(0,l.Lk)("div",{class:(0,a.C4)(["cursor-pointer",s.id===le.active.id?"border-r-2 border-blue":""])},[(0,l.Lk)("div",{class:"w-full p-2 pt-1 pb-1 md:p-4 md:pt-2 md:pb-2 border-b hover:bg-lightest flex",onClick:e=>ae.selectChat(s)},[le.active?((0,l.uX)(),(0,l.CE)("div",f,[ae.getUser(le.active.other_user_id)?((0,l.uX)(),(0,l.CE)("div",g,[(0,l.Lk)("div",p,[(0,l.Lk)("a",{href:`#/${ae.getUser(le.active.other_user_id).id}`},[(0,l.Lk)("img",{src:`${ae.getUser(le.active.other_user_id).avatar||"default_profile.png"}`,class:"h-12 w-12 rounded-full flex-none"},null,8,v)],8,m)]),(0,l.Lk)("div",w,[(0,l.Lk)("div",x,[(0,l.Lk)("p",k,(0,a.v_)(s.other_user_id),1),ae.getUser(le.active.other_user_id)?((0,l.uX)(),(0,l.CE)("p",b," @"+(0,a.v_)(ae.getUser(le.active.other_user_id).username||"Anonymous"),1)):(0,l.Q3)("",!0),(0,l.Lk)("p",y,(0,a.v_)(e.$filters.timeago(s.updated_at)),1)]),(0,l.bo)(((0,l.uX)(),(0,l.CE)("p",L,[(0,l.eW)((0,a.v_)(s.last_message||""),1)])),[[ne]])])])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0)],8,u)],2)])))),128))]))]),le.loading||!le.active?((0,l.uX)(),(0,l.CE)("div",_,[(0,l.Lk)("div",{class:(0,a.C4)(["top-0 left-0 w-full px-5 pt-1 pb-2 border-lighter flex bg-white",le.active?"border-b":""])},[(0,l.Lk)("button",{onClick:s[1]||(s[1]=e=>ae.gotoHome()),class:"block md:hidden rounded-full mr-2 focus:outline-none hover:bg-lightblue"},s[12]||(s[12]=[(0,l.Lk)("i",{class:"fas fa-arrow-left text-blue"},null,-1)]))],2),(0,l.Lk)("div",M,[(0,l.Lk)("div",C,[s[13]||(s[13]=(0,l.Lk)("p",{class:"font-bold text-lg"},"You don’t have a message selected",-1)),s[14]||(s[14]=(0,l.Lk)("p",{class:"text-sm text-dark"}," This is where you’ll see messages from people you don’t follow. They won’t know you’ve seen the request until you accept it. ",-1)),(0,l.Lk)("div",$,[(0,l.Lk)("button",{onClick:s[2]||(s[2]=e=>ae.newMessage()),type:"button",class:"h-10 px-2 text-white font-semibold bg-blue hover:bg-darkblue rounded-full"}," New Message ")])])])])):(0,l.Q3)("",!0),!le.loading&&le.active?((0,l.uX)(),(0,l.CE)("div",E,[ae.getUser(le.active.other_user_id)?((0,l.uX)(),(0,l.CE)("div",I,[(0,l.Lk)("div",{class:"px-5 pt-1 pb-2 border-b border-lighter flex bg-white sticky",onClick:s[4]||(s[4]=e=>ae.deselectAll())},[(0,l.Lk)("button",{onClick:s[3]||(s[3]=e=>ae.gotoHome()),class:"block md:hidden rounded-full mr-2 focus:outline-none hover:bg-lightblue"},s[15]||(s[15]=[(0,l.Lk)("i",{class:"fas fa-arrow-left text-blue"},null,-1)])),(0,l.Lk)("div",N,[(0,l.Lk)("a",{href:`#/${le.active.other_user_id}`},[(0,l.Lk)("img",{src:`${ae.getUser(le.active.other_user_id).avatar||"default_profile.png"}`,class:"flex-none w-6 h-6 rounded-full mt-2"},null,8,X)],8,U)]),(0,l.Lk)("div",T,[(0,l.Lk)("h1",j,(0,a.v_)(ae.getUser(le.active.other_user_id).username),1),(0,l.Lk)("p",Q,"@"+(0,a.v_)(le.active.other_user_id),1)]),s[16]||(s[16]=(0,l.Lk)("i",{class:"fas fa-info-circle ml-3 text-xl text-blue mt-2 cursor-pointer"},null,-1))]),(0,l.bo)(((0,l.uX)(),(0,l.CE)("div",S,[(0,l.Lk)("div",O,[(0,l.Lk)("div",P,[(0,l.Lk)("div",V,null,512),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(le.messages,(s=>((0,l.uX)(),(0,l.CE)("div",{key:s.id},[s.owner_id===this.ownerProfile.id?((0,l.uX)(),(0,l.CE)("div",F,[(0,l.Lk)("div",A,[(0,l.Lk)("div",D,(0,a.v_)(s.text),1)]),(0,l.Lk)("div",R,[(0,l.Lk)("p",W,(0,a.v_)(e.$filters.time(s.created_at)),1)])])):(0,l.Q3)("",!0),s.owner_id!==this.ownerProfile.id?((0,l.uX)(),(0,l.CE)("div",H,[(0,l.Lk)("div",K,[(0,l.Lk)("div",B,[(0,l.Lk)("a",{href:`#/${s.other_user_id}`},[(0,l.Lk)("img",{src:`${ae.getUser(le.active.other_user_id).avatar||"default_profile.png"}`,class:"object-cover h-8 w-8 rounded-full self-end"},null,8,q)],8,J)]),(0,l.Lk)("div",z,(0,a.v_)(s.text),1)]),(0,l.Lk)("div",Y,[(0,l.Lk)("p",G,(0,a.v_)(e.$filters.time(s.created_at)),1)])])):(0,l.Q3)("",!0)])))),128))])])])),[[de,ae.loadMore,"top"]]),(0,l.Lk)("div",Z,[(0,l.bo)((0,l.Lk)("input",{ref:"input",class:"pl-5 rounded-full w-full p-2 bg-lighter text-sm focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue",placeholder:"Start a new message",type:"search","onUpdate:modelValue":s[5]||(s[5]=e=>le.text=e),onKeyup:s[6]||(s[6]=(0,o.jR)((e=>ae.sendMessage()),["enter"])),disabled:le.disabled},null,40,ee),[[o.Jo,le.text]]),(0,l.Lk)("button",{class:(0,a.C4)(["rounded-full focus:outline-none right-4 ml-4 w-8 h-8",""+(0===le.text.length?"opacity-50 cursor-default":"hover:bg-lightblue")]),onClick:s[7]||(s[7]=e=>ae.sendMessage()),disabled:le.disabled},s[17]||(s[17]=[(0,l.Lk)("i",{class:"fas fa-arrow-right text-xl text-blue"},null,-1)]),10,se)])])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0)]),le.showNewMessageModal?((0,l.uX)(),(0,l.Wv)(ie,{key:0,profileId:le.active.other_user_id,showNewMessageModal:le.showNewMessageModal,"onUpdate:showNewMessageModal":s[8]||(s[8]=e=>le.showNewMessageModal=e),onSelected:ae.selected},null,8,["profileId","showNewMessageModal","onSelected"])):(0,l.Q3)("",!0)])}t(4114);var le=t(1787),ae={name:"Messages",components:{SideNav:(0,l.$V)((()=>t.e(529).then(t.bind(t,8529)))),Loader:(0,l.$V)((()=>t.e(945).then(t.bind(t,4945)))),NewMessageOverlay:(0,l.$V)((()=>t.e(166).then(t.bind(t,2166))))},data(){return{loading:!0,disabled:!1,showNewMessageModal:!1,chats:[],messages:[],ownerProfile:void 0,active:void 0,text:"",usersMap:new Map,otherUser:void 0}},methods:{newMessage(){this.showNewMessageModal=!0},gotoHome(){this.$router.push({name:"Home"})},async sendMessage(){if(!this.active.other_user_id||0===this.text.length)return;this.disabled=!0;const e=await le.n.sendDirectMessage({chatId:this.active.id,text:this.text});this.messages=[e,...this.messages],this.text="",this.disabled=!1,await this.$nextTick((()=>{this.scrollToEnd()}))},scrollToEnd(){this.$nextTick((()=>{const e=this.$refs.scrollToMe;e&&e.scrollIntoView({behavior:"smooth"}),this.$refs.input&&setTimeout((()=>this.$refs.input.focus()),500)}))},async selected(e){if(!this.ownerProfile.id||!e.id)return void console.log("messages: no selected(user)",this.ownerProfile,e);this.showNewMessageModal=!1;const s=`${this.ownerProfile.id}:${e.id}`,t=`${e.id}:${this.ownerProfile.id}`;let l=await le.n.getChat(s)||await le.n.getChat(t);l&&0!==l.id.length||(l={id:s,other_user_id:e.id,owner_id:""}),await this.selectChat(l)},async selectChat(e){this.messages=[],this.active=e;let s=await le.n.getDirectMessages({chatId:e.id,cursorReset:!0});this.messages=s.reverse(),this.scrollToEnd()},deselectAll(){this.active=void 0},getUser(e){return this.usersMap.get(e)},async loadChatOtherUser(e){const s=await le.n.getProfile(e);console.log("messages: loadChatOtherUser",s),s.avatar=await le.n.getImage({userId:s.id,key:s.avatar_key}),this.usersMap.set(s.id,s)},async loadMore(){if(!this.active)return;const e=await le.n.getDirectMessages({chatId:this.active.chat.id,cursorReset:!1});this.messages=[...this.messages,...e.messages]}},async created(){console.log("loading component:",this.$options.name),this.ownerProfile=le.n.getOwnerProfile();const e=await le.n.getChats(!0);if(console.log("messages: chats",e),0===e.length)return console.warn("messages: chats not found"),void(this.loading=!1);console.log("messages: route chat id:",this.$route.params.chatId),this.chats=e;for(const s of this.chats)s.id===this.$route.params.chatId&&(console.log("ACTIVE CHAT",JSON.stringify(s)),await this.selectChat(s)),await this.loadChatOtherUser(s.other_user_id);this.loading=!1}},oe=t(6262);const re=(0,oe.A)(ae,[["render",te]]);var ie=re},116:function(e,s,t){var l=t(6518),a=t(2652),o=t(9306),r=t(8551),i=t(1767);l({target:"Iterator",proto:!0,real:!0},{find:function(e){r(this),o(e);var s=i(this),t=0;return a(s,(function(s,l){if(e(s,t++))return l(s)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})}}]);
//# sourceMappingURL=messages.9028dab0.js.map