"use strict";(self["webpackChunkwarpnet_frontend"]=self["webpackChunkwarpnet_frontend"]||[]).push([[871],{9620:function(e,t,s){s.r(t),s.d(t,{default:function(){return M}});var a=s(641),l=s(33),o=s(3751);const r={class:"flex container h-full w-full"},i={class:"flex-1 flex flex-col h-full"},n={class:"px-4 py-3 border-b border-lighter flex items-center"},d={key:0,class:"flex items-center"},c=["src"],h={class:"font-bold"},u={class:"text-sm text-dark"},g={class:"flex-1 overflow-y-auto p-4",ref:"messageContainer"},f={key:0,class:"flex justify-center"},w={class:"text-xs mt-1 text-gray-500"},v={class:"border-t border-lighter px-4 py-3"};function p(e,t,s,p,b,m){const x=(0,a.g2)("SideNav"),k=(0,a.g2)("router-link"),M=(0,a.g2)("Loader"),y=(0,a.gN)("linkify");return(0,a.uX)(),(0,a.CE)("div",r,[(0,a.bF)(x),(0,a.Lk)("div",i,[(0,a.Lk)("div",n,[(0,a.bF)(k,{to:{name:"Chats"},class:"mr-4"},{default:(0,a.k6)((()=>t[2]||(t[2]=[(0,a.Lk)("i",{class:"fas fa-arrow-left text-xl text-blue"},null,-1)]))),_:1}),b.chat?((0,a.uX)(),(0,a.CE)("div",d,[(0,a.Lk)("img",{src:this.otherUser.avatar||"default_profile.png",class:"w-10 h-10 rounded-full mr-3"},null,8,c),(0,a.Lk)("div",null,[(0,a.Lk)("p",h,(0,l.v_)(this.otherUser.username),1),(0,a.Lk)("p",u,"@"+(0,l.v_)(b.chat.other_user_id),1)])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",g,[b.loading?((0,a.uX)(),(0,a.CE)("div",f,[(0,a.bF)(M,{loading:b.loading},null,8,["loading"])])):((0,a.uX)(!0),(0,a.CE)(a.FK,{key:1},(0,a.pI)(b.messages,(t=>((0,a.uX)(),(0,a.CE)("div",{key:t.id,class:(0,l.C4)(["mb-4 flex",{"justify-end":t.owner_id===b.currentUserId}])},[(0,a.Lk)("div",{class:(0,l.C4)(["max-w-3/4 rounded-lg px-4 py-2",t.owner_id===b.currentUserId?"bg-blue text-white":"bg-lighter"])},[(0,a.bo)(((0,a.uX)(),(0,a.CE)("p",null,[(0,a.eW)((0,l.v_)(t.content),1)])),[[y]]),(0,a.Lk)("p",w,(0,l.v_)(e.$filters.timeago(t.created_at)),1)],2)],2)))),128))],512),(0,a.Lk)("div",v,[(0,a.Lk)("form",{onSubmit:t[1]||(t[1]=(0,o.D$)(((...e)=>m.sendMessage&&m.sendMessage(...e)),["prevent"])),class:"flex"},[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>b.newMessage=e),type:"text",placeholder:"Type a message...",class:"flex-1 rounded-full border border-lighter px-4 py-2 mr-2"},null,512),[[o.Jo,b.newMessage]]),t[3]||(t[3]=(0,a.Lk)("button",{type:"submit",class:"bg-blue text-white rounded-full px-6 py-2"}," Send ",-1))],32)])])])}s(4114);var b=s(1787),m={name:"Chat",components:{SideNav:(0,a.$V)((()=>s.e(529).then(s.bind(s,8529)))),Loader:(0,a.$V)((()=>s.e(945).then(s.bind(s,4945))))},data(){return{loading:!0,chat:null,messages:[],newMessage:"",chatId:void 0,currentUserId:void 0,otherUser:void 0}},methods:{async loadChat(){try{this.chat=await b.n.getChat({chatId:this.chatId})}catch(e){console.error("Error loading chat:",e)}},async loadMessages(){try{const e=await b.n.getDirectMessages({chatId:this.chatId,cursorReset:!0});this.messages=[...e,...this.messages],this.loading=!1}catch(e){console.error("Error loading messages:",e),this.loading=!1}},async sendMessage(){if(this.newMessage.trim())try{const e=await b.n.sendDirectMessage({chatId:this.chatId,text:this.newMessage});this.messages.push(e),this.newMessage="",this.scrollToBottom()}catch(e){console.error("Error sending message:",e)}},scrollToBottom(){this.$nextTick((()=>{const e=this.$refs.messageContainer;e.scrollTop=e.scrollHeight}))}},async created(){console.log("loading component:",this.$options.name),this.currentUserId=this.$route.params.id,this.chatId=this.$route.params.chatId;const e=this.chatId.split(":")[0];this.otherUser=await b.n.getProfile(e),await Promise.all([this.loadChat(),this.loadMessages()]),this.scrollToBottom()}},x=s(6262);const k=(0,x.A)(m,[["render",p]]);var M=k},3812:function(e,t,s){s.r(t),s.d(t,{default:function(){return h}});var a=s(641);const l={id:"app",class:"flex container h-full w-full"},o={class:"flex container h-full w-full"};function r(e,t,s,r,i,n){const d=(0,a.g2)("SideNav"),c=(0,a.g2)("ChatList"),h=(0,a.g2)("NewMessageOverlay"),u=(0,a.gN)("scroll");return(0,a.bo)(((0,a.uX)(),(0,a.CE)("div",l,[(0,a.Lk)("div",o,[(0,a.bF)(d),(0,a.bF)(c,{chats:i.chats,loading:i.loading,active:i.active,getUser:n.getUser,onSelectChat:n.selectChat,onNewMessage:n.newMessage},null,8,["chats","loading","active","getUser","onSelectChat","onNewMessage"]),t[1]||(t[1]=(0,a.Lk)("div",{class:"w-full border-l border-r border-lighter h-screen flex items-center justify-center"},[(0,a.Lk)("div",{class:"text-center"},[(0,a.Lk)("h2",{class:"text-2xl font-bold mb-4"},"Select a chat"),(0,a.Lk)("p",{class:"text-gray-600"},"Choose a chat from the list to start chatting")])],-1)),i.showNewMessageModal?((0,a.uX)(),(0,a.Wv)(h,{key:0,showNewMessageModal:i.showNewMessageModal,"onUpdate:showNewMessageModal":t[0]||(t[0]=e=>i.showNewMessageModal=e),profileId:this.profileId,onSelected:n.selected},null,8,["showNewMessageModal","profileId","onSelected"])):(0,a.Q3)("",!0)])])),[[u,n.loadMore,"bottom"]])}s(4114),s(8111),s(116);var i=s(1787),n={name:"Chats",components:{ChatList:(0,a.$V)((()=>s.e(557).then(s.bind(s,6557)))),NewMessageOverlay:(0,a.$V)((()=>s.e(777).then(s.bind(s,9777)))),Loader:(0,a.$V)((()=>s.e(945).then(s.bind(s,4945)))),SideNav:(0,a.$V)((()=>s.e(529).then(s.bind(s,8529))))},data(){return{loading:!0,showNewMessageModal:!1,chats:[],profileId:"",usersMap:new Map,otherUser:void 0,active:null}},methods:{newMessage(){this.showNewMessageModal=!0},async selectChat(e){e&&0!==e.id.length&&this.$router.push({name:"Messages",params:{id:this.$route.params.id,chatId:e.id}})},async selected(e){if(console.log("selected()"),!e||0===e.id.length)return;this.showNewMessageModal=!1;const t=this.chats.find((t=>t.other_user_id===e.id));if(t)return this.active=t.id,void await this.selectChat(t);const s=await i.n.createChat(e.id);this.active=s.id,await this.selectChat(s)},getUser(e){return console.log("getUser()"),console.log("chats.length",this.chats.length),this.usersMap.get(e)},async loadChatOtherUser(e){if(console.log("loadChatOtherUser()"),!e||0===e.length)return;const t=await i.n.getProfile(e);t.avatar=await i.n.getImage({userId:t.id,key:t.avatar_key}),this.usersMap.set(t.id,t),console.log("usersMap",this.usersMap)},async loadMore(){console.log("loadMore()");const e=await i.n.getChats(!1);for(const t of e)await this.loadChatOtherUser(t.other_user_id);this.chats=[...this.chats,...e]}},async created(){console.log("created()"),console.log("loading component:",this.$options.name),this.profileId=this.$route.params.id;const e=await i.n.getChats(!0);console.log("chats",e);for(const t of e)console.log("chat cycle",t),await this.loadChatOtherUser(t.other_user_id);console.log("usersMap",this.usersMap),console.log("end cycle"),this.chats=e,console.log("chats length",this.chats.length),this.loading=!1}},d=s(6262);const c=(0,d.A)(n,[["render",r]]);var h=c},672:function(e,t,s){s.r(t),s.d(t,{default:function(){return B}});var a=s(641),l=s(33),o=s(3751);const r={id:"app",class:"flex container h-full w-full"},i={class:"flex container h-full w-full"},n={key:0,class:"w-full z-0 h-screen border-l border-r border-lighter overflow-y-scroll no-scrollbar relative flex flex-col items-center justify-center"},d={class:"flex flex-col items-center justify-center w-full"},c={class:"w-3/5"},h={class:"flex justify-start mt-5"},u={key:1,class:"w-full border-l border-r border-lighter h-screen flex justify-center"},g={key:0},f={class:"flex-none mr-4"},w=["href"],v=["src"],p={class:"w-full flex flex-col"},b={class:"text-m font-bold flex-1"},m={class:"text-dark text-xs"},x={class:"w-full pt-5 overflow-y-scroll no-scrollbar",style:{display:"grid","grid-template-rows":"auto"}},k={class:"w-full px-5 flex flex-col justify-between"},M={class:"flex flex-col-reverse mt-1 h-full",style:{"min-height":"100%"}},y={ref:"scrollToMe"},C={key:0},L={class:"flex justify-end"},_={class:"mr-2 py-3 px-4 bg-blue rounded-bl-3xl rounded-tl-3xl rounded-tr-xl text-white"},$={class:"flex justify-end w-full mb-4"},N={class:"text-xs text-dark mr-2"},U={key:1},I={class:"flex justify-start"},E={class:"flex-none mr-4"},S=["href"],T=["src"],X={class:"ml-2 py-3 px-4 bg-lighter rounded-br-3xl rounded-tr-3xl rounded-tl-xl text-black"},j={class:"flex items-center w-full mb-4"},P={class:"text-xs text-dark ml-14"},V={class:"bg-white px-5 p-3 border-t border-lighter flex w-full"},O=["disabled"],F=["disabled"];function D(e,t,s,D,Q,R){const A=(0,a.g2)("SideNav"),H=(0,a.g2)("ChatList"),B=(0,a.g2)("NewMessageOverlay"),K=(0,a.gN)("scroll");return(0,a.uX)(),(0,a.CE)("div",r,[(0,a.Lk)("div",i,[(0,a.bF)(A),(0,a.bF)(H,{chats:Q.chats,loading:Q.loading,active:Q.active,getUser:R.getUser,onSelectChat:R.selectChat,onNewMessage:R.newMessage},null,8,["chats","loading","active","getUser","onSelectChat","onNewMessage"]),Q.loading||!Q.active?((0,a.uX)(),(0,a.CE)("div",n,[(0,a.Lk)("div",{class:(0,l.C4)(["top-0 left-0 w-full px-5 pt-1 pb-2 border-lighter flex bg-white",Q.active?"border-b":""])},[(0,a.Lk)("button",{onClick:t[0]||(t[0]=e=>R.gotoHome()),class:"block md:hidden rounded-full mr-2 focus:outline-none hover:bg-lightblue"},t[8]||(t[8]=[(0,a.Lk)("i",{class:"fas fa-arrow-left text-blue"},null,-1)]))],2),(0,a.Lk)("div",d,[(0,a.Lk)("div",c,[t[9]||(t[9]=(0,a.Lk)("p",{class:"font-bold text-lg"},"You don’t have a message selected",-1)),t[10]||(t[10]=(0,a.Lk)("p",{class:"text-sm text-dark"}," This is where you’ll see messages from people you don’t follow. They won’t know you’ve seen the request until you accept it. ",-1)),(0,a.Lk)("div",h,[(0,a.Lk)("button",{onClick:t[1]||(t[1]=e=>R.newMessage()),type:"button",class:"h-10 px-2 text-white font-semibold bg-blue hover:bg-darkblue rounded-full"}," New Message ")])])])])):(0,a.Q3)("",!0),!Q.loading&&Q.active?((0,a.uX)(),(0,a.CE)("div",u,[R.getUser(Q.active.other_user_id)?((0,a.uX)(),(0,a.CE)("div",g,[(0,a.Lk)("div",{class:"px-5 pt-1 pb-2 border-b border-lighter flex bg-white sticky",onClick:t[3]||(t[3]=e=>R.deselectAll())},[(0,a.Lk)("button",{onClick:t[2]||(t[2]=e=>R.gotoHome()),class:"block md:hidden rounded-full mr-2 focus:outline-none hover:bg-lightblue"},t[11]||(t[11]=[(0,a.Lk)("i",{class:"fas fa-arrow-left text-blue"},null,-1)])),(0,a.Lk)("div",f,[(0,a.Lk)("a",{href:`#/${Q.active.other_user_id}`},[(0,a.Lk)("img",{src:`${R.getUser(Q.active.other_user_id).avatar||"default_profile.png"}`,class:"flex-none w-6 h-6 rounded-full mt-2"},null,8,v)],8,w)]),(0,a.Lk)("div",p,[(0,a.Lk)("h1",b,(0,l.v_)(R.getUser(Q.active.other_user_id).username),1),(0,a.Lk)("p",m,"@"+(0,l.v_)(Q.active.other_user_id),1)]),t[12]||(t[12]=(0,a.Lk)("i",{class:"fas fa-info-circle ml-3 text-xl text-blue mt-2 cursor-pointer"},null,-1))]),(0,a.bo)(((0,a.uX)(),(0,a.CE)("div",x,[(0,a.Lk)("div",k,[(0,a.Lk)("div",M,[(0,a.Lk)("div",y,null,512),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(Q.messages,(t=>((0,a.uX)(),(0,a.CE)("div",{key:t.id},[t.owner_id===this.ownerProfile.id?((0,a.uX)(),(0,a.CE)("div",C,[(0,a.Lk)("div",L,[(0,a.Lk)("div",_,(0,l.v_)(t.text),1)]),(0,a.Lk)("div",$,[(0,a.Lk)("p",N,(0,l.v_)(e.$filters.time(t.created_at)),1)])])):(0,a.Q3)("",!0),t.owner_id!==this.ownerProfile.id?((0,a.uX)(),(0,a.CE)("div",U,[(0,a.Lk)("div",I,[(0,a.Lk)("div",E,[(0,a.Lk)("a",{href:`#/${t.other_user_id}`},[(0,a.Lk)("img",{src:`${R.getUser(Q.active.other_user_id).avatar||"default_profile.png"}`,class:"object-cover h-8 w-8 rounded-full self-end"},null,8,T)],8,S)]),(0,a.Lk)("div",X,(0,l.v_)(t.text),1)]),(0,a.Lk)("div",j,[(0,a.Lk)("p",P,(0,l.v_)(e.$filters.time(t.created_at)),1)])])):(0,a.Q3)("",!0)])))),128))])])])),[[K,R.loadMore,"top"]]),(0,a.Lk)("div",V,[(0,a.bo)((0,a.Lk)("input",{ref:"input",class:"pl-5 rounded-full w-full p-2 bg-lighter text-sm focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue",placeholder:"Start a new message",type:"search","onUpdate:modelValue":t[4]||(t[4]=e=>Q.text=e),onKeyup:t[5]||(t[5]=(0,o.jR)((e=>R.sendMessage()),["enter"])),disabled:Q.disabled},null,40,O),[[o.Jo,Q.text]]),(0,a.Lk)("button",{class:(0,l.C4)(["rounded-full focus:outline-none right-4 ml-4 w-8 h-8",""+(0===Q.text.length?"opacity-50 cursor-default":"hover:bg-lightblue")]),onClick:t[6]||(t[6]=e=>R.sendMessage()),disabled:Q.disabled},t[13]||(t[13]=[(0,a.Lk)("i",{class:"fas fa-arrow-right text-xl text-blue"},null,-1)]),10,F)])])):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0),Q.showNewMessageModal?((0,a.uX)(),(0,a.Wv)(B,{key:2,showNewMessageModal:Q.showNewMessageModal,"onUpdate:showNewMessageModal":t[7]||(t[7]=e=>Q.showNewMessageModal=e),onSelected:R.selected},null,8,["showNewMessageModal","onSelected"])):(0,a.Q3)("",!0)])])}s(4114);var Q=s(1787),R={name:"Messages",components:{ChatList:(0,a.$V)((()=>s.e(557).then(s.bind(s,6557)))),SideNav:(0,a.$V)((()=>s.e(529).then(s.bind(s,8529)))),Loader:(0,a.$V)((()=>s.e(945).then(s.bind(s,4945)))),NewMessageOverlay:(0,a.$V)((()=>s.e(777).then(s.bind(s,9777))))},data(){return{loading:!0,disabled:!1,showNewMessageModal:!1,chats:[],messages:[],ownerProfile:void 0,active:void 0,text:"",usersMap:new Map,otherUser:void 0}},methods:{newMessage(){this.showNewMessageModal=!0},gotoHome(){this.$router.push({name:"Home"})},async sendMessage(){if(!this.active.other_user_id||0===this.text.length)return;this.disabled=!0;const e=await Q.n.sendDirectMessage({chatId:this.active.id,text:this.text});this.messages=[e,...this.messages],this.text="",this.disabled=!1,await this.$nextTick((()=>{this.scrollToEnd()}))},scrollToEnd(){this.$nextTick((()=>{const e=this.$refs.scrollToMe;e&&e.scrollIntoView({behavior:"smooth"}),this.$refs.input&&setTimeout((()=>this.$refs.input.focus()),500)}))},async selected(e){if(!this.ownerProfile.id||!e.id)return;this.showNewMessageModal=!1;const t=`${this.ownerProfile.id}:${e.id}`,s=`${e.id}:${this.ownerProfile.id}`;let a=await Q.n.getChat(t)||await Q.n.getChat(s);a||(a={id:t,other_user_id:e.id,owner_id:""}),await this.selectChat(a)},async selectChat(e){this.messages=[],this.active=e;let t=await Q.n.getDirectMessages({chatId:e.id,cursorReset:!0});this.messages=t.reverse(),this.scrollToEnd()},deselectAll(){this.active=void 0},getUser(e){return this.usersMap.get(e)},async loadChatOtherUser(e){const t=await Q.n.getProfile(e);t.avatar=await Q.n.getImage({userId:t.id,key:t.avatar_key}),this.usersMap.set(t.id,t)},async loadMore(){if(!this.active)return;const e=await Q.n.getDirectMessages({chatId:this.active.chat.id,cursorReset:!1});this.messages=[...this.messages,...e.messages]}},async created(){console.log("loading component:",this.$options.name),this.ownerProfile=Q.n.getOwnerProfile();const e=await Q.n.getChats(!0);if(e&&0!==e.length){this.chats=e,console.log("chats",e);for(const e of this.chats)console.log("chat cycle",e),await this.loadChatOtherUser(e.other_user_id);console.log("chats[0]",e[0]),await this.selectChat(e[0]),this.loading=!1}else this.loading=!1}},A=s(6262);const H=(0,A.A)(R,[["render",D]]);var B=H},116:function(e,t,s){var a=s(6518),l=s(2652),o=s(9306),r=s(8551),i=s(1767);a({target:"Iterator",proto:!0,real:!0},{find:function(e){r(this),o(e);var t=i(this),s=0;return l(t,(function(t,a){if(e(t,s++))return a(t)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})}}]);
//# sourceMappingURL=messages.14f6861c.js.map