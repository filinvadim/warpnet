"use strict";(self["webpackChunkwarpnet_frontend"]=self["webpackChunkwarpnet_frontend"]||[]).push([[871],{2370:function(e,s,l){l.r(s),l.d(s,{default:function(){return je}});var t=l(641),o=l(33),r=l(3751);const a={id:"app",class:"flex container h-full w-full"},i={class:"flex container h-full w-full"},n={class:"w-full sm:w-1/3 md:w-1/2 lg:w-1/2 h-full overflow-y-scroll no-scrollbar hidden md:block"},d={key:0},c={key:0,class:"flex flex-col items-center justify-center w-full pt-10"},u=["onClick"],f={class:"flex-none mr-2 md:mr-4 pt-1"},h=["href"],g=["src"],p={class:"w-full truncate"},m={class:"flex items-center w-full"},v={class:"font-semibold"},w={class:"hidden md:block text-sm text-dark ml-2 truncate"},k={class:"text-sm text-dark ml-auto"},b={class:"pb-2 truncate"},x={key:0,class:"w-full z-0 h-screen border-l border-r border-lighter overflow-y-scroll no-scrollbar relative flex flex-col items-center justify-center",style:{display:"grid","grid-template-rows":"53px auto"}},L={class:"flex flex-col items-center justify-center w-full"},y={class:"w-3/5"},M={class:"flex justify-start mt-5"},C={key:1,class:"w-full border-l border-r border-lighter h-screen",style:{display:"grid","grid-template-rows":"53px auto 53px"}},N={class:"flex-none mr-4"},E=["href"],$=["src"],U={class:"w-full flex flex-col"},_={class:"text-m font-bold flex-1"},X={class:"text-dark text-xs"},A={class:"w-full pt-5 overflow-y-scroll no-scrollbar",style:{display:"grid","grid-template-rows":"auto"}},S={class:"w-full px-5 flex flex-col justify-between"},j={class:"flex flex-col-reverse mt-1 h-full",style:{"min-height":"100%"}},T={ref:"scrollToMe"},I={key:0},P={class:"flex justify-end"},Q={class:"mr-2 py-3 px-4 bg-blue rounded-bl-3xl rounded-tl-3xl rounded-tr-xl text-white"},R={class:"flex justify-end w-full mb-4"},q={class:"text-xs text-dark mr-2"},D={key:1},F={class:"flex justify-start"},K={class:"flex-none mr-4"},H=["href"],O=["src"],W={class:"ml-2 py-3 px-4 bg-lighter rounded-br-3xl rounded-tr-3xl rounded-tl-xl text-black"},B={class:"flex items-center w-full mb-4"},V={class:"text-xs text-dark ml-14"},z={class:"bg-white px-5 p-3 border-t border-lighter flex w-full"},J=["disabled"],Y=["disabled"];function G(e,s,l,G,Z,ee){const se=(0,t.g2)("SideNav"),le=(0,t.g2)("Loader"),te=(0,t.g2)("NewMessageOverlay"),oe=(0,t.gN)("linkify"),re=(0,t.gN)("scroll");return(0,t.uX)(),(0,t.CE)("div",a,[(0,t.Lk)("div",i,[(0,t.bF)(se),(0,t.Lk)("div",n,[(0,t.Lk)("div",{class:"px-5 py-3 border-b border-lighter flex",onClick:s[1]||(s[1]=e=>ee.deselectAll())},[s[9]||(s[9]=(0,t.Lk)("h1",{class:"text-xl font-bold flex-1"},"Messages",-1)),s[10]||(s[10]=(0,t.Lk)("i",{class:"fas fa-cog text-xl text-blue cursor-pointer"},null,-1)),(0,t.Lk)("i",{onClick:s[0]||(s[0]=e=>ee.newMessage()),class:"fas fa-plus-circle ml-3 text-xl text-blue cursor-pointer"})]),(0,t.bF)(le,{loading:Z.loading},null,8,["loading"]),Z.loading?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("div",d,[0===e.conversations.length?((0,t.uX)(),(0,t.CE)("div",c,s[11]||(s[11]=[(0,t.Lk)("div",{class:"w-1/2 flex flex-col items-center justify-center"},[(0,t.Lk)("p",{class:"font-bold text-lg"},"No conversations yet"),(0,t.Lk)("p",{class:"text-sm text-dark"}," Wait until someone starts a conversation here. ")],-1)]))):(0,t.Q3)("",!0),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(e.conversations,(s=>((0,t.uX)(),(0,t.CE)("div",{key:s.id+s.lastMessage},[(0,t.Lk)("div",{class:(0,o.C4)(["cursor-pointer",e.active&&s.id===e.active.id?"border-r-2 border-blue":""])},[(0,t.Lk)("div",{class:"w-full p-2 pt-1 pb-1 md:p-4 md:pt-2 md:pb-2 border-b hover:bg-lightest flex",style:(0,o.Tr)(e.hasNewMessages(s)?"background-color:#e1f5fe;":""),onClick:e=>ee.selectConversation(s)},[(0,t.Lk)("div",f,[(0,t.Lk)("a",{href:`#/${s.otherUser.username}`},[(0,t.Lk)("img",{src:`${s.otherUser.avatar||"default_profile.png"}`,class:"h-12 w-12 rounded-full flex-none"},null,8,g)],8,h)]),(0,t.Lk)("div",p,[(0,t.Lk)("div",m,[(0,t.Lk)("p",v,(0,o.v_)(s.otherUser.id),1),(0,t.Lk)("p",w," @"+(0,o.v_)(s.otherUser.username),1),(0,t.Lk)("p",k,(0,o.v_)(e.$filters.timeago(s.lastModified)),1)]),(0,t.bo)(((0,t.uX)(),(0,t.CE)("p",b,[(0,t.eW)((0,o.v_)(s.lastMessage),1)])),[[oe]])])],12,u)],2)])))),128))]))]),Z.loading||!e.active?((0,t.uX)(),(0,t.CE)("div",x,[(0,t.Lk)("div",{class:(0,o.C4)(["top-0 left-0 w-full px-5 pt-1 pb-2 border-lighter flex bg-white",e.active?"border-b":""])},[(0,t.Lk)("button",{onClick:s[2]||(s[2]=e=>ee.gotoHome()),class:"block md:hidden rounded-full mr-2 focus:outline-none hover:bg-lightblue"},s[12]||(s[12]=[(0,t.Lk)("i",{class:"fas fa-arrow-left text-blue"},null,-1)]))],2),(0,t.Lk)("div",L,[(0,t.Lk)("div",y,[s[13]||(s[13]=(0,t.Lk)("p",{class:"font-bold text-lg"},"You don’t have a message selected",-1)),s[14]||(s[14]=(0,t.Lk)("p",{class:"text-sm text-dark"}," This is where you’ll see messages from people you don’t follow. They won’t know you’ve seen the request until you accept it. ",-1)),(0,t.Lk)("div",M,[(0,t.Lk)("button",{onClick:s[3]||(s[3]=e=>ee.newMessage()),type:"button",class:"h-10 px-2 text-white font-semibold bg-blue hover:bg-darkblue rounded-full"}," New Message ")])])])])):(0,t.Q3)("",!0),!Z.loading&&e.active?((0,t.uX)(),(0,t.CE)("div",C,[(0,t.Lk)("div",{class:"px-5 pt-1 pb-2 border-b border-lighter flex bg-white sticky",onClick:s[5]||(s[5]=s=>{ee.deselectAll(),e.active=void 0})},[(0,t.Lk)("button",{onClick:s[4]||(s[4]=e=>ee.gotoHome()),class:"block md:hidden rounded-full mr-2 focus:outline-none hover:bg-lightblue"},s[15]||(s[15]=[(0,t.Lk)("i",{class:"fas fa-arrow-left text-blue"},null,-1)])),(0,t.Lk)("div",N,[(0,t.Lk)("a",{href:`#/${e.active.otherUser.username}`},[(0,t.Lk)("img",{src:`${e.active.otherUser.avatar||"default_profile.png"}`,class:"flex-none w-6 h-6 rounded-full mt-2"},null,8,$)],8,E)]),(0,t.Lk)("div",U,[(0,t.Lk)("h1",_,(0,o.v_)(e.active.otherUser.username),1),(0,t.Lk)("p",X,"@"+(0,o.v_)(e.active.otherUser.id),1)]),s[16]||(s[16]=(0,t.Lk)("i",{class:"fas fa-info-circle ml-3 text-xl text-blue mt-2 cursor-pointer"},null,-1))]),(0,t.bo)(((0,t.uX)(),(0,t.CE)("div",A,[(0,t.Lk)("div",S,[(0,t.Lk)("div",j,[(0,t.Lk)("div",T,null,512),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(e.messages,(s=>((0,t.uX)(),(0,t.CE)("div",{key:s.id},[e.isMyMessage(s.from.username)?((0,t.uX)(),(0,t.CE)("div",I,[(0,t.Lk)("div",P,[(0,t.Lk)("div",Q,(0,o.v_)(s.message),1)]),(0,t.Lk)("div",R,[(0,t.Lk)("p",q,(0,o.v_)(e.$filters.time(s.timestamp)),1)])])):(0,t.Q3)("",!0),e.isMyMessage(s.from.username)?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("div",D,[(0,t.Lk)("div",F,[(0,t.Lk)("div",K,[(0,t.Lk)("a",{href:`#/${s.from.username}`},[(0,t.Lk)("img",{src:`${s.from.avatar||"default_profile.png"}`,class:"object-cover h-8 w-8 rounded-full self-end"},null,8,O)],8,H)]),(0,t.Lk)("div",W,(0,o.v_)(s.message),1)]),(0,t.Lk)("div",B,[(0,t.Lk)("p",V,(0,o.v_)(e.$filters.time(s.timestamp)),1)])]))])))),128))])])])),[[re,ee.loadMore,"top"]]),(0,t.Lk)("div",z,[(0,t.bo)((0,t.Lk)("input",{ref:"input",class:"pl-5 rounded-full w-full p-2 bg-lighter text-sm focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue",placeholder:"Start a new message",type:"search","onUpdate:modelValue":s[6]||(s[6]=e=>Z.message=e),onKeyup:s[7]||(s[7]=(0,r.jR)((e=>ee.sendMessage()),["enter"])),disabled:Z.disabled},null,40,J),[[r.Jo,Z.message]]),(0,t.Lk)("button",{class:(0,o.C4)(["rounded-full focus:outline-none right-4 ml-4 w-8 h-8",""+(0==Z.message.length?"opacity-50 cursor-default":"hover:bg-lightblue")]),onClick:s[8]||(s[8]=e=>ee.sendMessage()),disabled:Z.disabled},s[17]||(s[17]=[(0,t.Lk)("i",{class:"fas fa-arrow-right text-xl text-blue"},null,-1)]),10,Y)])])):(0,t.Q3)("",!0),Z.showNewMessageModal?((0,t.uX)(),(0,t.Wv)(te,{key:2,showNewMessageModal:Z.showNewMessageModal,onSelected:ee.selected},null,8,["showNewMessageModal","onSelected"])):(0,t.Q3)("",!0)])])}l(4114),l(8992),l(3949);var Z=l(1450),ee=l(5587);const se={class:"fixed w-full h-full top-0 left-0 flex items-center justify-center"},le={class:"modal-main bg-white mx-auto rounded-lg z-50 overflow-y-auto w-full sm:w-3/5 md:w-2/5 max-h-full"},te={class:"pl-1 pr-4 py-1 h-16 border-b-2 border-lightblue"},oe={class:"flex flex-row mt-1 ml-4"},re={class:"border-l-2 border-r-2 border-white"},ae={class:"p-3 flex flex-col border-b"},ie={class:"lg:block w-full"},ne={key:0,class:"flex flex-col items-center justify-center w-full pt-10"},de={class:"w-3/5"},ce={class:"font-bold text-lg"};function ue(e,s,l,a,i,n){const d=(0,t.g2)("Loader"),c=(0,t.g2)("ResultsNewMessage");return(0,t.uX)(),(0,t.CE)("div",se,[(0,t.Lk)("div",{class:"absolute w-full h-full bg-gray-900 opacity-50",onClick:s[0]||(s[0]=(0,r.D$)((s=>e.$emit("update:showNewMessageModal",!1)),["prevent"]))}),(0,t.Lk)("div",le,[(0,t.Lk)("div",te,[(0,t.Lk)("div",oe,[(0,t.Lk)("i",{onClick:s[1]||(s[1]=s=>e.$emit("update:showNewMessageModal",!1)),class:"fas fa-times text-blue text-2xl w-10 h-10 mr-1 xl:mr-6 mt-1 pt-1 pl-3 rounded-full bg-white hover:bg-lightblue"}),s[4]||(s[4]=(0,t.Lk)("p",{class:"text-xl pt-1 font-bold mt-1"},"New message",-1))])]),(0,t.Lk)("div",re,[(0,t.Lk)("div",ae,[(0,t.Lk)("div",ie,[s[5]||(s[5]=(0,t.Lk)("i",{class:"fas fa-search absolute mt-3 ml-5 text-m text-light"},null,-1)),(0,t.bo)((0,t.Lk)("input",{class:"pl-12 rounded-full w-full p-2 bg-lighter text-m focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue",placeholder:"Search People",type:"search","onUpdate:modelValue":s[2]||(s[2]=e=>i.query=e),onKeyup:s[3]||(s[3]=(0,r.jR)((e=>n.submit()),["enter"]))},null,544),[[r.Jo,i.query]])])]),(0,t.bF)(d,{loading:i.loading},null,8,["loading"]),!i.loading&&e.results&&0===e.results.length?((0,t.uX)(),(0,t.CE)("div",ne,[(0,t.Lk)("div",de,[(0,t.Lk)("p",ce,'No results for "'+(0,o.v_)(i.noResults)+'"',1),s[6]||(s[6]=(0,t.Lk)("p",{class:"text-sm text-dark"}," The query you entered did not bring up any results. ",-1))])])):(0,t.Q3)("",!0),(0,t.bF)(c,{results:e.results,onSelected:n.selected},null,8,["results","onSelected"])])])])}function fe(e,s,l,o,r,a){const i=(0,t.g2)("UserNewMessage");return(0,t.uX)(),(0,t.CE)("div",null,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(l.results,(e=>((0,t.uX)(),(0,t.CE)("div",{key:e.id},[e.username?((0,t.uX)(),(0,t.Wv)(i,{key:0,user:e,onSelected:a.selected},null,8,["user","onSelected"])):(0,t.Q3)("",!0)])))),128))])}const he={class:"flex-none"},ge=["src"],pe={class:"ml-2 flex flex-col w-full"},me={class:"flex flex-row justify-between w-full"},ve={class:"flex flex-col"},we={class:"font-bold"},ke={class:"text-dark text-sm"};function be(e,s,l,r,a,i){return e.profile.id!==l.user.id?((0,t.uX)(),(0,t.CE)("div",{key:0,onClick:s[0]||(s[0]=e=>l.user.followedBy&&i.selected(l.user)),class:(0,o.C4)(["w-full px-4 py-2 border-b hover:bg-lightest flex flex-row cursor-pointer",l.user.followedBy?"":"cursor-not-allowed opacity-60"])},[(0,t.Lk)("div",he,[(0,t.Lk)("img",{src:`${l.user.avatar||"default_profile.png"}`,class:"h-12 w-12 rounded-full"},null,8,ge)]),(0,t.Lk)("div",pe,[(0,t.Lk)("div",me,[(0,t.Lk)("div",ve,[(0,t.Lk)("p",we,(0,o.v_)(l.user.username),1),(0,t.Lk)("p",ke," @"+(0,o.v_)(l.user.id)+" "+(0,o.v_)(l.user.followedBy?"":"cant'be messaged"),1)])])])],2)):(0,t.Q3)("",!0)}var xe=l(6278),Le={name:"User",props:["user"],computed:{...(0,xe.L8)("warpnet",["profile"])},methods:{selected(e){this.$emit("selected",e)}}},ye=l(6262);const Me=(0,ye.A)(Le,[["render",be]]);var Ce=Me,Ne={name:"ResultsNewMessage",props:["results"],components:{UserNewMessage:Ce},computed:{...(0,xe.L8)("warpnet",{cursor:"cursorSearch"}),...(0,xe.L8)("warpnet",["profile"])},methods:{selected(e){this.$emit("selected",e)}}};const Ee=(0,ye.A)(Ne,[["render",fe]]);var $e=Ee,Ue={name:"NewMessageOverlay",components:{ResultsNewMessage:$e,Loader:ee.A},props:["showNewMessageModal"],data(){return{loading:!0,query:"",noResults:"",mode:"People"}},computed:{...(0,xe.L8)("warpnet",{results:"search"}),...(0,xe.L8)("warpnet",["profile"])},methods:{...(0,xe.i0)("warpnet",["loadProfile","loadSearch","loadMoreSearch","resetSearch"]),async openConversation(e){console.log(e),this.$emit("update:showNewMessageModal",!1)},async submit(){this.noResults=this.query,this.resetSearch(),await this.loadSearch({query:this.query,mode:this.mode,limit:20}).then((()=>{this.loading=!1}))},selected(e){this.$emit("selected",e)}},created(){window.addEventListener("keyup",(()=>{27===event.keyCode&&this.$emit("update:showNewMessageModal",!1)})),this.submit()},destroyed:function(){window.removeEventListener("keyup",(()=>{27===event.keyCode&&this.$emit("update:showNewMessageModal",!1)}))}};const _e=(0,ye.A)(Ue,[["render",ue]]);var Xe=_e,Ae={name:"Messages",components:{SideNav:Z.A,Loader:ee.A,NewMessageOverlay:Xe},data(){return{loading:!0,message:"",disabled:!1,showNewMessageModal:!1,lastNextToken:void 0}},computed:{...(0,xe.L8)("warpnet",{isMyMessage:"isSelf",active:"conversation",userProfile:"profile"}),...(0,xe.L8)("warpnet",["conversations","messages","hasNewMessages","cursorMessages"]),...(0,xe.L8)("profilePage",["profile"])},methods:{...(0,xe.i0)("authentication",["loginUserIfAlreadyAuthenticated"]),...(0,xe.i0)("warpnet",["loadConversations","getDirectMessages","sendDirectMessage","setActiveConversation","loadMoreDirectMessages"]),...(0,xe.i0)("profilePage",["loadProfile"]),newMessage(){this.showNewMessageModal=!0},gotoHome(){this.$router.push({name:"Home"})},async selectConversation(e){this.setActiveConversation(e),await this.getDirectMessages({otherUserId:e.otherUser.id,limit:10}),this.scrollToEnd()},sendMessage(){this.active.otherUser.id&&0!=this.message.length&&(this.disabled=!0,this.sendDirectMessage({message:this.message,otherUserId:this.active.otherUser.id}).then((()=>{this.message="",this.disabled=!1,this.$nextTick((()=>{this.scrollToEnd()}))})))},scrollToEnd(){this.$nextTick((()=>{const e=this.$refs.scrollToMe;e&&e.scrollIntoView({behavior:"smooth"}),setTimeout((()=>this.$refs.input.focus()),500)}))},async selected(e){if(!this.userProfile.id||!e.id)return;this.showNewMessageModal=!1;const s=`${this.userProfile.id}_${e.id}`,l=`${e.id}_${this.userProfile.id}`;let t;if(this.conversations.forEach((e=>{e.id!=s&&e.id!=l||(t=e)})),t)await this.selectConversation(t);else{let l={id:s,lastMessage:void 0,lastModified:void 0,otherUser:{...e}};this.setActiveConversation(l),await this.selectConversation(l)}},deselectAll(){this.setActiveConversation(void 0)},async loadMore(){this.active&&await this.loadMoreDirectMessages({otherUserId:this.active.otherUser.id,limit:10}).catch((e=>{console.log(e)}))}},async created(){this.conversations.length>0&&(this.loading=!1),this.conversation&&this.scrollToEnd(),await this.loginUserIfAlreadyAuthenticated(),await this.loadConversations(10).then((()=>this.loading=!1)),this.profile.id!=this.userProfile.id&&await this.selected(this.profile)}};const Se=(0,ye.A)(Ae,[["render",G]]);var je=Se},7588:function(e,s,l){var t=l(6518),o=l(2652),r=l(9306),a=l(8551),i=l(1767);t({target:"Iterator",proto:!0,real:!0},{forEach:function(e){a(this),r(e);var s=i(this),l=0;o(s,(function(s){e(s,l++)}),{IS_RECORD:!0})}})},3949:function(e,s,l){l(7588)}}]);
//# sourceMappingURL=messages.6c46e17b.js.map