#!/bin/bash

echo "Pre-commit hook started..."

FILE="config.yml"

if [ ! -f "$FILE" ]; then
    echo "config file not found!"
    exit 1
fi

CURRENT_VERSION=$(grep -m 1 '^version:' "$FILE" | awk '{print $2}')
IFS='.' read -r MAJOR MINOR PATCH <<< "$CURRENT_VERSION"
PATCH=$((PATCH + 1))
NEW_VERSION="$MAJOR.$MINOR.$PATCH"
echo "$NEW_VERSION" > $FILE
git add .
git tag -a "v$NEW_VERSION" -m "Release version $NEW_VERSION"
echo "Version updated to $NEW_VERSION and tag created."